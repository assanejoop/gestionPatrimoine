<!-- fournisseurs.component.html -->
<div class="fournisseurs-container max-w-7xl mx-auto">
  <!-- Header -->


  <!-- Title Section -->
  <div class="title-section flex justify-between">
    <div class="flex flex-col">
    <h1 class="text-dark">Gestion des Fournisseurs</h1>
    <p class="subtitle">Suivre les prestataires et les engagements financiers</p>
  </div>
    <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
      <!-- Period Selector -->
      <div class="relative">
        <select 
          class="appearance-none bg-white  rounded-lg px-4 py-2 pr-8 text-dark focus:outline-none focus:ring-2  font-inter" >
          <option class="text-dark text-sm font-inter" value="periode"> <i class="fa-regular fa-calendar"></i> P√©riode</option>
          <option>Cette semaine</option>
          <option>Ce mois</option>
          <option selected>Cette ann√©e</option>
          <option>Toutes les p√©riodes</option>
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-dark">
          <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
          </svg>
        </div>
      </div>
      

      
      <!-- Region Selector -->
      <div class="relative">
        <select 
          class="appearance-none bg-white rounded-[10px] px-4 py-2 pr-8 text-dark focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <option>R√©gion</option>
          <option selected>Toutes les r√©gions</option>
          <option>Dakar</option>
          <option>Thi√®s</option>
          <option>Saint-Louis</option>
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-dark">
          <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
          </svg>
        </div>
      </div>
      
      <div class="relative inline-block text-left">
        <!-- Bouton principal -->
        <button 
        (click)="toggleDropdown()"
          class="bg-[#3072BC] hover:bg-[#3072BC] text-white px-6 py-2 rounded-[5px] flex items-center gap-2 transition-colors duration-200 p-[10px]">
          <!-- <i class="fa-solid fa-up-right-from-square"></i> -->
           <img src="assets/images/icones/export.png" alt="" srcset="">
          Exporter
        </button>
  
        <!-- Menu dropdown -->
        <div
          *ngIf="isOpen"
          class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
          [@slideInOut]
        >
          <div class="py-1">
            <!-- En-t√™te du dropdown -->
            <div class="px-4 py-2 text-sm text-gray-500 border-b border-gray-100">
              Exporter sous
            </div>
            
            <!-- Option PDF -->
            <button
              (click)="exportToPDF()"
              class="group flex items-center w-full px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-900 transition-colors duration-150"
            >
              <!-- Ic√¥ne PDF -->
              <div class="flex-shrink-0 w-8 h-8 mr-3  rounded flex items-center justify-center">
                <img src="assets/images/icones/pdf.png" alt="" srcset="">
              </div>
              <span class="font-medium">PDF</span>
            </button>
  
            <!-- Option Excel -->
            <button
              (click)="exportToExcel()"
              class="group flex items-center w-full px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-900 transition-colors duration-150"
            >
              <!-- Ic√¥ne Excel -->
              <div class="flex-shrink-0 w-8 h-8 mr-3 rounded flex items-center justify-center">
                <img src="assets/images/icones/excel.png" alt="" srcset="">
              </div>
              <span class="font-medium">EXCEL</span>
            </button>
          </div>
        </div>
      </div>
     
    </div>
  </div>


  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <!-- Documents associ√©s -->
    <div class="bg-white rounded-lg  p-6 ">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-3xl font-bold text-gray-900">{{ formatNumber(documentStats.associatedDocuments) }}</div>
          <div class="text-gray-600 mt-1">Fournisseur actifs</div>
        </div>
        <div class="w-12 h-12 bg-white shadow-[0px_2px_10px_0px_#7C8DB51F] rounded-lg flex items-center justify-center">
          <img src="assets/images/icones/users1.png" alt="" srcset="">
        </div>
      </div>
    </div>

    <!-- Documents archiv√©s -->
    <div class="bg-white rounded-lg p-6 ">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-3xl font-bold text-gray-900">{{ formatNumber(documentStats.archivedDocuments) }}</div>
          <div class="text-gray-600 mt-1">Contrats en cours</div>
        </div>
        <div class="w-12 h-12  bg-white shadow-[0px_2px_10px_0px_#7C8DB51F] rounded-lg flex items-center justify-center">
       <img src="assets/images/icones/check.png" alt="" srcset="">
        </div>
      </div>
    </div>

    <!-- Documents expir√©s -->
    <div class="bg-white rounded-lg p-6 ">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-3xl font-bold text-gray-900">{{ formatNumber(documentStats.expiredDocuments) }}</div>
          <div class="text-gray-600 mt-1">Taux de statisfaction</div>
        </div>
        <div class="w-12 h-12  bg-white shadow-[0px_2px_10px_0px_#7C8DB51F] rounded-lg flex items-center justify-center">
          <img src="assets/images/icones/check.png" alt="" srcset="">
        </div>
      </div>
    </div>
  </div>
  <!-- Charts Section -->
  <div class="charts-grid">
    <!-- R√©partition par sp√©cialit√© -->
    <div class="chart-card">
      <h3>R√©partition par sp√©cialit√©</h3>
      <div class="pie-chart-container">
        <div class="chart-wrapper">
          <canvas id="pieChart" width="200" height="200"></canvas>
        </div>
        <div class="pie-legend">
          <div class="legend-item" *ngFor="let item of specialiteData()">
            <span class="legend-color" [style.background-color]="item.color"></span>
            <span class="legend-text">{{ item.specialite }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Montant factur√© vs pay√© -->
    <div class="chart-card">
      <h3>Montant factur√© vs pay√© (%)</h3>
      <div class="donut-chart-container">
        <div class="chart-wrapper">
          <canvas id="donutChart" width="180" height="180"></canvas>
          <div class="percentage-badge">20%</div>
        </div>
        <div class="donut-legend">
          <div class="legend-item">
            <span class="legend-color" style="background-color: #4285f4;"></span>
            <span class="legend-text">Montant factur√©</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background-color: #a8c7fa;"></span>
            <span class="legend-text">Montant pay√©</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bar Charts Section -->
  <div class="bar-charts-grid">
    <!-- Contrats actifs par fournisseur -->
    <div class="chart-card">
      <h3>Contrats actifs par fournisseur</h3>
      <div class="bar-chart-wrapper">
        <canvas id="contractsChart" width="400" height="280"></canvas>
      </div>
      <div class="chart-legend">
        <div class="legend-item">
          <span class="legend-color" style="background-color: #4285f4;"></span>
          <span class="legend-text">Contrats actifs</span>
        </div>
      </div>
    </div>

    <!-- Montant engag√© par fournisseur -->
    <div class="chart-card">
      <h3>Montant engag√© par fournisseur</h3>
      <div class="bar-chart-wrapper">
        <canvas id="montantChart" width="400" height="280"></canvas>
      </div>
      <div class="chart-legend">
        <div class="legend-item">
          <span class="legend-color" style="background-color: #4285f4;"></span>
          <span class="legend-text">Montant en (Fcfa)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Historique des interventions -->
  <div class="history-section">
    <h3>Historique des interventions</h3>
    <div class="history-list">
      <div class="history-item" *ngFor="let intervention of interventionsHistorique()">
        <div class="history-icon" [ngClass]="intervention.icon">
          <span class="history-icon-symbol">
            @switch (intervention.icon) {
              @case ('maintenance') { üîß }
              @case ('delivery') { üì¶ }
              @case ('security') { üîí }
              @default { üìã }
            }
          </span>
        </div>
        <div class="history-content">
          <div class="history-title">{{ intervention.type }}</div>
          <div class="history-meta">
            <span class="history-date">{{ intervention.date }} {{ intervention.time }}</span>
            <span class="history-provider">{{ intervention.fournisseur }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>