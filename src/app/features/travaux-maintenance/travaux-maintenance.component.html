<div class="min-h-screen bg-gray-50 p-6">
  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-dark mb-2">Travaux & Maintenance</h1>
      <p class="text-gray-600">Suivre les activités techniques et coûts associés</p>
    </div>
    
    <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
      <!-- Period Selector -->
      <div class="relative">
        <select 
          class="appearance-none bg-white  rounded-lg px-4 py-2 pr-8 text-dark focus:outline-none focus:ring-2  font-inter" >
          <option class="text-dark text-sm font-inter" value="periode"> <i class="fa-regular fa-calendar"></i> Période</option>
          <option>Cette semaine</option>
          <option>Ce mois</option>
          <option selected>Cette année</option>
          <option>Toutes les périodes</option>
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-dark">
          <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
          </svg>
        </div>
      </div>
      

      
      <!-- Region Selector -->
      <div class="relative">
        <select 
          class="appearance-none bg-white rounded-[10px] px-4 py-2 pr-8 text-dark focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <option>Région</option>
          <option selected>Toutes les régions</option>
          <option>Dakar</option>
          <option>Thiès</option>
          <option>Saint-Louis</option>
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-dark">
          <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
          </svg>
        </div>
      </div>
      
      <div class="relative inline-block text-left">
        <!-- Bouton principal -->
        <button 
        (click)="toggleDropdown()"
          class="bg-[#3072BC] hover:bg-[#3072BC] text-white px-6 py-2 rounded-[5px] flex items-center gap-2 transition-colors duration-200 p-[10px]">
          <!-- <i class="fa-solid fa-up-right-from-square"></i> -->
           <img src="assets/images/icones/export.png" alt="" srcset="">
          Exporter
        </button>
  
        <!-- Menu dropdown -->
        <div
          *ngIf="isOpen"
          class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
          [@slideInOut]
        >
          <div class="py-1">
            <!-- En-tête du dropdown -->
            <div class="px-4 py-2 text-sm text-gray-500 border-b border-gray-100">
              Exporter sous
            </div>
            
            <!-- Option PDF -->
            <button
              (click)="exportToPDF()"
              class="group flex items-center w-full px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-900 transition-colors duration-150"
            >
              <!-- Icône PDF -->
              <div class="flex-shrink-0 w-8 h-8 mr-3  rounded flex items-center justify-center">
                <img src="assets/images/icones/pdf.png" alt="" srcset="">
              </div>
              <span class="font-medium">PDF</span>
            </button>
  
            <!-- Option Excel -->
            <button
              (click)="exportToExcel()"
              class="group flex items-center w-full px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-900 transition-colors duration-150"
            >
              <!-- Icône Excel -->
              <div class="flex-shrink-0 w-8 h-8 mr-3 rounded flex items-center justify-center">
                <img src="assets/images/icones/excel.png" alt="" srcset="">
              </div>
              <span class="font-medium">EXCEL</span>
            </button>
          </div>
        </div>
      </div>
     
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="bg-white p-4 rounded-lg ">
      <div class="flex items-center justify-between mb-2">
        <div class="text-2xl font-bold text-primary mb-1">{{ stats().plannedWorks }}</div>
        <div class="w-12 h-12  bg-white shadow-[0px_2px_10px_0px_#7C8DB51F] rounded-lg flex items-center justify-center">
          <img src="assets/images/icones/users1.png" alt="" srcset="">
           </div>
      </div>
    
      <div class="text-[#000000] mb-2 font-poppins font-normal text-xl leading-6 tracking-normal">Travaux planifiés</div>
      <div class="flex items-center text-xs text-green-600">
        <span class="mr-1">↗️</span>
        <span class="text-[#7C8DB5] text-sm">+5 nouveaux cette année</span>
      </div>
    </div>

    <div class="bg-white p-4 rounded-lg ">
      <div class="flex items-center justify-between mb-2">   
      <div class="text-2xl font-bold text-primary mb-1">{{ stats().inProgress }}</div>
        <div class="w-12 h-12  bg-white shadow-[0px_2px_10px_0px_#7C8DB51F] rounded-lg flex items-center justify-center">
          <img src="assets/images/icones/check.png" alt="" srcset="">
           </div>
      </div>
      <div class="text-[#000000] mb-2 font-poppins font-normal text-xl leading-6 tracking-normal">En cours</div>
      <div class="flex items-center text-xs text-yellow-600">
        <span class="mr-1">⚠️</span>
        <span class="text-[#7C8DB5] text-sm">02 En litige</span>
      </div>
    </div>

    <div class="bg-white p-4 rounded-lg ">
      <div class="flex items-center justify-between mb-2">
        <div class="text-2xl font-bold text-primary mb-1">{{ stats().completed }}</div>
        <div class="w-12 h-12  bg-white shadow-[0px_2px_10px_0px_#7C8DB51F] rounded-lg flex items-center justify-center">
          <img src="assets/images/icones/check.png" alt="" srcset="">
           </div>
      </div>
     
      <div class="text-[#000000] mb-2 font-poppins font-normal text-xl leading-6 tracking-normal">Achevés</div>
      <div class="flex items-center text-xs text-yellow-600">
        <span class="mr-1">⚠️</span>
        <span class="text-[#7C8DB5] text-sm">02 En litige</span>
      </div>
    </div>

    <div class="bg-white p-4 rounded-lg ">
      <div class="flex items-center justify-between mb-2">
        <div class="text-2xl font-bold text-primary mb-1">{{ stats().budgetConsumed }}%</div>
        <div class="w-12 h-12  bg-white shadow-[0px_2px_10px_0px_#7C8DB51F] rounded-lg flex items-center justify-center">
          <img src="assets/images/icones/check.png" alt="" srcset="">
           </div>
      </div>
  
      <div class="text-[#000000] mb-2 font-poppins font-normal text-xl leading-6 tracking-normal">Budget consommé</div>
      <div class="text-xs text-gray-500">
        <span>Sur {{ formatCurrency(stats().totalBudget) }}</span>
      </div>
    </div>
  </div>

  
  <!-- Première ligne: 2 cartes égales -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Travaux planifiés/en cours/achevés -->
    <div class="bg-white p-6 rounded-lg ">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-primary">Travaux planifiés / en cours / achevés</h3>
      </div>
      <div class="flex items-center gap-4 mb-4 text-sm">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-blue-500 rounded"></div>
          <span>Planifiés</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-yellow-500 rounded"></div>
          <span>En cours</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-green-500 rounded"></div>
          <span>Achevés</span>
        </div>
      </div>
      <div class="h-64">
        <canvas #monthlyWorksChart></canvas>
      </div>
    </div>

    <!-- Répartition par type -->
    <div class="bg-white p-6 rounded-lg ">
      <h3 class="text-lg font-semibold text-primary mb-4">Répartition par type de travaux</h3>
      <div class="h-64 flex items-center justify-center">
        <canvas #workTypeChart></canvas>
      </div>
      <div class="grid grid-cols-2 gap-2 mt-4 text-sm">
        <div *ngFor="let item of workTypeDistribution()" class="flex items-center gap-2">
          <div class="w-3 h-3 rounded" [style.background-color]="item.color"></div>
          <span>{{ item.type }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Deuxième ligne: 65% + 35% -->
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-6">
    <!-- Délai moyen d'exécution - 65% -->
    <div class="lg:col-span-8 bg-white p-6 rounded-lg ">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-primary">Délai moyen d'exécution (jours)</h3>
        <select class="px-3 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option>Jour</option>
        </select>
      </div>
      <div class="h-64">
        <canvas #executionDelayChart></canvas>
      </div>
    </div>

    <!-- Travaux en retard - 35% -->
    <div class="lg:col-span-4 bg-white p-6 rounded-lg ">
      <h3 class="text-lg font-semibold text-primary mb-4">Travaux en retard (%)</h3>
      <div class="h-64 flex items-center justify-center">
        <canvas #delayedWorksChart></canvas>
      </div>
    </div>
  </div>

  <!-- Troisième ligne: 2 cartes égales -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Incidents signalés -->
    <div class="bg-white p-6 rounded-lg">
      <h3 class="text-lg font-semibold text-primary mb-4">Incidents signalés par bâtiment</h3>
      <div class="flex items-center gap-2 mb-4 text-sm">
        <div class="w-3 h-3 bg-orange-500 rounded"></div>
        <span>Incidents</span>
      </div>
      <div class="h-64">
        <canvas #incidentsChart></canvas>
      </div>
    </div>

    <!-- Interventions par fournisseur -->
    <div class="bg-white p-6 rounded-lg ">
      <h3 class="text-lg font-semibold text-primary mb-4">Interventions par fournisseur</h3>
      <div class="flex items-center gap-4 mb-4 text-sm">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-blue-500 rounded"></div>
          <span>Électricité</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-green-500 rounded"></div>
          <span>Plomberie</span>
        </div>
      </div>
      <div class="h-64">
        <canvas #supplierChart></canvas>
      </div>
    </div>
  </div>

  <!-- Dernière ligne: Coût moyen par type - 50% de la largeur centré -->
  <div class="flex">
    <div class="w-full max-w-2xl bg-white p-6 rounded-lg ">
      <h3 class="text-lg font-semibold text-primary mb-4">Coût moyen par type de travaux</h3>
      <div class="flex items-center gap-2 mb-4 text-sm">
        <div class="w-3 h-3 bg-blue-500 rounded"></div>
        <span>Coût moyen en (Fcfa)</span>
      </div>
      <div class="h-64">
        <canvas #costChart></canvas>
      </div>
    </div>
  </div>
</div>